\documentclass[12pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath, amssymb, mathtools}
\usepackage{tikz}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{float}
\usepackage{parskip}
\usepackage{tabularx}
\usepackage[utf8]{inputenc}
\usepackage{tgpagella}
\usepackage[T1]{fontenc}
\usepackage{array} % For better table features
\usepackage{booktabs}
\usepackage{tcolorbox}
\usepackage{enumitem}

\title{Basics of Market Microstructure}
\author{Zubin}
\date{\today}

\begin{document}
\maketitle

\tableofcontents

\newpage

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Markets and Limit Orders}

\subsection{Introduction to Trading Mechanics}
We now move on from the basics of financial statements and risk-return relationships to the mechanics of trading on exchanges. Transaction costs eat into investment returns, so it is important to understand how to measure these costs and manage orders to minimize them.

\subsection{What is an Order?}
An order is a set of instructions sent to an exchange (usually via a broker) to trade a financial security. Every order must specify:
\begin{enumerate}
    \item \textbf{Security:} The asset to trade, usually identified by a Ticker Symbol (e.g., AMZN for Amazon, F for Ford).
    \item \textbf{Side:} Whether to Buy or Sell.
    \item \textbf{Quantity:} The number of shares or units to trade.
\end{enumerate}
Orders may also include additional instructions, such as price limits, expiration terms, or exchange routing.

\subsection{Market Orders}
A \textbf{Market Order} is the simplest type of order, containing only the three required instructions (Security, Side, Quantity).
\begin{itemize}
    \item \textbf{Definition:} An order to execute the trade immediately at the best currently available price.
    \item \textbf{Pros:} Execution is almost certain.
    \item \textbf{Cons:} Price is uncertain. You accept whatever the market offers, which might be unfavorable in volatile conditions.
\end{itemize}
\textbf{Example:} A market order to buy 100 shares of Twitter guarantees you get the shares, but the price is determined by the market at the moment of execution.

\subsection{Limit Orders}
A \textbf{Limit Order} allows the trader to specify the price at which they are willing to trade. This specified price is called the \textbf{Limit Price}.
\begin{itemize}
    \item \textbf{Buy Limit Order:} Sets a \textbf{maximum} purchase price. The trade executes only at the limit price or lower.
    \item \textbf{Sell Limit Order:} Sets a \textbf{minimum} selling price. The trade executes only at the limit price or higher.
\end{itemize}
\textbf{Example:} If you place a limit order to buy Twitter at \$19, you ensure you never pay more than \$19. If the market price is \$19.50, the order will not execute.

\subsection{Summary: Market vs. Limit Orders}
\begin{itemize}
    \item \textbf{Market Orders:} Execution is certain; Price is uncertain.
    \item \textbf{Limit Orders:} Price is controlled (certain not to be worse than limit); Execution is uncertain.
\end{itemize}
Most modern exchanges are \textbf{Electronic Limit Order Markets}, where limit and market orders interact to facilitate trading.

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Limit Order Book}

\subsection{Introduction}
In this section, we examine how limit orders enter the order book and await execution. We will define key concepts such as the best bid and ask prices, the bid-ask spread, and market depth. Furthermore, we will observe how market orders and marketable limit orders interact with the order book to generate trades.

\subsection{Definitions}
\begin{itemize}
    \item \textbf{Best Ask Price:} The lowest price at which someone is willing to sell shares.
    \item \textbf{Best Bid Price:} The highest price at which someone is willing to buy shares.
    \item \textbf{Bid-Ask Spread:} The difference between the best ask price and the best bid price.
    \item \textbf{Depth:} The number of shares available for trading at a specific price level.
\end{itemize}

\subsection{Order Book Dynamics: An Example}
Consider the limit order book for a hypothetical stock, XYZ Incorporated. Initially, the order book is empty.

\subsubsection{Step 1: Arrival of Passive Orders}
A trader sends an order (\textbf{S1}) to sell 150 shares of XYZ with a limit price of \$40.
\begin{itemize}
    \item This order sits on the sell side.
    \item \textbf{Current Best Ask:} \$40.
\end{itemize}

A few seconds later, a buy order (\textbf{B1}) for 225 shares at \$39.95 enters the market.
\begin{itemize}
    \item S1 is not willing to sell below \$40, and B1 is not willing to pay more than \$39.95. They do not execute.
    \item \textbf{Current Best Bid:} \$39.95.
    \item \textbf{Bid-Ask Spread:} $40 - 39.95 = \$0.05$.
\end{itemize}

These orders (S1 and B1) are referred to as \textbf{Standing} or \textbf{Passive Limit Orders}. They provide liquidity and face execution uncertainty (no guarantee they will be filled).

\subsubsection{Step 2: Improving the Bid}
Another buy order (\textbf{B2}) arrives for 500 shares at \$39.97.
\begin{itemize}
    \item B2 does not match S1 (\$40), but it offers a higher price than B1.
    \item \textbf{New Best Bid:} \$39.97.
    \item \textbf{New Spread:} $40 - 39.97 = \$0.03$.
\end{itemize}

\textbf{Current Depth:}
\begin{itemize}
    \item Depth at Best Ask (\$40): 150 shares.
    \item Depth at Best Bid (\$39.97): 500 shares.
\end{itemize}

\subsubsection{Step 3: Market Order Execution}
A market order (\textbf{S2}) to sell 300 shares arrives.
\begin{itemize}
    \item Market orders trade at the current best available prices.
    \item S2 interacts with the best bid (B2 at \$39.97).
    \item \textbf{Execution:} 300 shares trade at \$39.97.
    \item \textbf{Result:} S2 is filled completely. B2 has 200 shares remaining ($500 - 300$).
    \item The Best Bid price remains \$39.97, but depth has decreased to 200.
\end{itemize}

\subsubsection{Step 4: Marketable Limit Order}
A sell order (\textbf{S3}) arrives for 250 shares with a limit price of \$39.95.
\begin{itemize}
    \item S3 is willing to sell at \$39.95 or higher. The best bid is \$39.97 (higher than limit), so it executes immediately.
    \item \textbf{Trade 1:} 200 shares execute against the remainder of B2 at \$39.97. (B2 is now filled).
    \item S3 still needs to sell 50 shares. The next best bid is B1 at \$39.95.
    \item \textbf{Trade 2:} 50 shares execute against B1 at \$39.95.
    \item \textbf{Result:} S3 is filled. B1 has 175 shares remaining ($225 - 50$).
\end{itemize}

\textbf{Marketable Limit Orders (Active Orders):}
S3 is an example of a marketable limit order. Like a market order, execution was immediate (no uncertainty). However, price was uncertain (executed at multiple prices: \$39.97 and \$39.95), though never worse than the limit price.

\subsubsection{Final State}
\begin{itemize}
    \item \textbf{Best Ask:} \$40 (S1, 150 shares).
    \item \textbf{Best Bid:} \$39.95 (Remainder of B1, 175 shares).
    \item \textbf{Spread:} \$0.05.
\end{itemize}

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{More Limit Order Book}

\subsection{Introduction}
In this section, we explore what happens when a marketable limit order cannot be fully executed due to price restrictions. We also examine how large market orders execute against the book, moving prices and creating \textbf{price impact}.

\subsection{Expanding the Order Book Example}
Let's advance the state of the order book from the previous section.
\begin{itemize}
    \item \textbf{Existing Orders:} S1 (Sell 150 @ \$40.00) and B1 (Buy 175 @ \$39.95).
\end{itemize}
We add the following new orders:
\begin{itemize}
    \item \textbf{Sell Side:}
          \begin{itemize}
              \item S4: 500 shares @ \$40.02
              \item S5: 1,000 shares @ \$40.05
              \item S6: 1,500 shares @ \$40.10
          \end{itemize}
    \item \textbf{Buy Side:}
          \begin{itemize}
              \item B3: 600 shares @ \$39.99
              \item B4: 900 shares @ \$39.96
          \end{itemize}
\end{itemize}

\textbf{Current State:}
\begin{itemize}
    \item \textbf{Best Ask:} \$40.00 (S1)
    \item \textbf{Best Bid:} \$39.99 (B3)
    \item \textbf{Bid-Ask Spread:} \$0.01
\end{itemize}

\textit{Note: In reality, market depth at a specific price is often the aggregate of multiple orders. For simplicity, we assume one order per price level here.}

\subsection{Partial Execution of Marketable Limit Orders}
A new buy order (\textbf{B5}) arrives for \textbf{400 shares} with a limit price of \textbf{\$40.00}.

\textbf{Execution Logic:}
\begin{enumerate}
    \item B5 is willing to pay up to \$40.00.
    \item The best ask is S1 (150 shares @ \$40.00).
    \item \textbf{Trade:} 150 shares execute at \$40.00. S1 is filled.
    \item \textbf{Remaining B5:} 250 shares ($400 - 150$) still need to be bought.
    \item The next best ask is S4 at \$40.02. Since B5's limit is \$40.00, it cannot execute against S4.
\end{enumerate}

\textbf{Result:}
The remaining 250 shares of B5 enter the book as a standing limit order at \$40.00.
\begin{itemize}
    \item \textbf{New Best Bid:} \$40.00 (B5, 250 shares).
    \item \textbf{New Best Ask:} \$40.02 (S4, 500 shares).
    \item \textbf{New Spread:} \$0.02.
\end{itemize}

\subsection{Large Market Orders and Price Impact}
A large market order (\textbf{B6}) arrives to buy \textbf{2,000 shares}.
\textit{(Note: Market orders have no price restrictions and execute immediately against available liquidity).}

\textbf{Execution Logic:}
B6 sweeps through the sell side of the book until filled:
\begin{enumerate}
    \item \textbf{Trade 1:} 500 shares @ \$40.02 (Clears S4).
    \item \textbf{Trade 2:} 1,000 shares @ \$40.05 (Clears S5).
    \item \textbf{Trade 3:} 500 shares @ \$40.10 (Partially fills S6).
\end{enumerate}
Total filled: $500 + 1,000 + 500 = 2,000$ shares.

\textbf{Observations:}
\begin{itemize}
    \item \textbf{Price Uncertainty:} Although execution was guaranteed, the price varied. The average price paid is higher than the initial best ask.
    \item \textbf{Price Impact:} The aggressive buying pressure moved the best ask price from \$40.02 to \$40.10. This change (\$0.08) represents the price impact of the order.
\end{itemize}

\textbf{Post-Trade State:}
\begin{itemize}
    \item \textbf{Best Ask:} \$40.10 (Remaining 1,000 shares of S6).
    \item \textbf{Best Bid:} \$40.00 (B5).
    \item \textbf{Spread:} \$0.10.
\end{itemize}

\subsection{Restoring Liquidity}
A new sell order (\textbf{S7}) enters at \textbf{\$40.05} for 500 shares.
\begin{itemize}
    \item This improves the best ask from \$40.10 to \$40.05.
    \item \textbf{New Spread:} \$0.05.
\end{itemize}

\subsection{Summary: Liquidity Provision vs. Consumption}
\begin{itemize}
    \item \textbf{Liquidity Providers:} Orders that sit in the book awaiting execution (e.g., S1, B5 remainder). They offer options for others to trade against.
    \item \textbf{Liquidity Consumers:} Orders that execute immediately (e.g., B6). They remove liquidity from the book.
\end{itemize}

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Limit Price Placement}

\subsection{Introduction}
Limit price placement refers to where the limit price of an order lies relative to the current best quotes (Best Bid and Best Ask). This concept is central to defining \textbf{Order Aggressiveness}.

\textbf{Baseline for Examples:}
\begin{itemize}
    \item \textbf{Best Ask:} \$40.00 (150 shares).
    \item \textbf{Best Bid:} \$39.95 (235 shares).
\end{itemize}

\subsection{Hierarchy of Order Aggressiveness}
Aggressiveness depends on how far the limit price is from the best quotes.

\subsubsection{1. Market Orders (Most Aggressive)}
Market orders have no price restrictions.
\begin{itemize}
    \item A market sell order can be viewed as a limit order with a price of \$0.
    \item A market buy order can be viewed as a limit order with a price of infinity ($\infty$).
\end{itemize}

\subsubsection{2. Marketable Limit Orders (Instant Full Execution)}
These are limit orders that execute immediately and completely because their prices cross the spread significantly.
\begin{itemize}
    \item \textbf{Buy Order:} Limit Price $\ge$ Best Ask.
    \item \textbf{Sell Order:} Limit Price $\le$ Best Bid.
\end{itemize}
\textbf{Aggressiveness Logic:} The further the price crosses the spread, the more aggressive it is. A sell order at \$39.25 is more aggressive than one at \$39.50. A buy order at \$40.40 is more aggressive than one at \$40.20.

\subsubsection{3. Marketable Limit Orders (Partial Execution)}
Orders that cross the spread but have a size larger than the available depth at the best price.
\begin{itemize}
    \item \textbf{Example:} Sell 500 shares at \$39.95.
    \item \textbf{Result:} Since the best bid depth is only 235 shares, 235 shares execute immediately. The remaining 265 shares sit on the book (or execute against lower bids if available).
\end{itemize}

\subsubsection{4. Quote Improving Orders}
Orders that do not execute immediately but improve the Best Bid or Best Ask. They narrow the Bid-Ask Spread.
\begin{itemize}
    \item \textbf{Example Sell:} Limit price \$39.99 (Improves Best Ask from \$40.00).
    \item \textbf{Example Buy:} Limit price \$39.97 (Improves Best Bid from \$39.95).
\end{itemize}

\subsubsection{5. Quote Matching Orders}
Orders that simply add depth to the existing best quotes without changing the price.
\begin{itemize}
    \item \textbf{Example:} Buy 50 shares at \$39.95.
    \item \textbf{Result:} Best Bid remains \$39.95, but depth increases from 235 to 285 shares.
\end{itemize}

\subsubsection{6. Behind the Quote Orders (Least Aggressive)}
Orders placed at prices worse than the current best quotes.
\begin{itemize}
    \item \textbf{Example:} Buy 500 shares at \$39.90.
    \item \textbf{Result:} The order sits in the book behind the best bid, awaiting execution.
\end{itemize}

\subsection{Liquidity Demanding vs. Liquidity Supplying}
\begin{itemize}
    \item \textbf{Liquidity Demanding (Consuming):} Orders that result in at least partial execution upon submission (Categories 1, 2, and 3). They trade against existing orders.
    \item \textbf{Liquidity Supplying (Providing):} Orders that sit on the order book awaiting execution (Categories 4, 5, and 6). They provide the liquidity that others demand.
\end{itemize}

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Stop-Loss Orders}

\subsection{Introduction}
In this section, we discuss stop-loss orders and their purpose. These orders, also known as \textbf{stop orders} or \textbf{stop market orders}, are primarily used to prevent losses on existing positions.

\subsection{How Stop-Loss Orders Work}
\textbf{Example:}
Suppose you bought 100 shares of XYZ Incorporated at \$40 per share. You want to limit your potential loss to 10\%. You place a stop-loss order to sell 100 shares with a \textbf{stop price} (or \textbf{trigger price}) of \$36.

\begin{itemize}
    \item \textbf{Visibility:} Stop-loss orders are held separately and do not appear in the public limit order book.
    \item \textbf{Triggering:} As long as trades occur above \$36, the order remains dormant. If a trade executes at \$36 or below, the stop order is triggered.
    \item \textbf{Execution:} Once triggered, it becomes a \textbf{regular market order} to sell. It executes against available orders in the book.
    \item \textbf{Price Uncertainty:} The actual execution price may be at, below, or even above \$36, depending on market volatility in the split second between triggering and execution.
\end{itemize}

\subsection{Trigger Price vs. Limit Price}
It is crucial to distinguish between a limit order and a stop order with the same price.
\begin{itemize}
    \item \textbf{Limit Sell Order (\$36):} Guarantees you will not sell for less than \$36. It is an instruction to sell at \$36 or higher.
    \item \textbf{Stop-Loss Sell Order (\$36):} Activates only when the market price drops to \$36. It does not guarantee a minimum price; it guarantees entry into the market to exit the position.
\end{itemize}

\subsection{Selecting the Trigger Price}
The trigger price should be chosen relative to the stock's volatility.
\begin{itemize}
    \item \textbf{Scenario:} You set a trigger 10\% below purchase price, but the stock has a daily volatility of 15\%.
    \item \textbf{Risk:} The order is likely to be triggered by normal daily fluctuations rather than a sustained downturn.
    \item \textbf{Best Practice:} Stop-loss orders should protect against sustained adverse price movements, not regular noise.
\end{itemize}

\subsection{Stop-Limit Orders}
To mitigate price uncertainty, traders can use \textbf{Stop-Limit Orders}.
\begin{itemize}
    \item \textbf{Mechanism:} When the trigger price is hit, the order becomes a \textbf{limit order} rather than a market order.
    \item \textbf{Parameters:} You must specify both a \textbf{Trigger Price} and a \textbf{Limit Price}.
    \item \textbf{Trade-off:}
          \begin{itemize}
              \item \textbf{Stop-Loss Market Order:} Guaranteed execution, uncertain price.
              \item \textbf{Stop-Limit Order:} Controlled price, uncertain execution. In a fast-crashing market, the price may drop below your limit before you get filled, leaving you with the position.
          \end{itemize}
\end{itemize}

\subsection{Stop-Loss for Short Selling}
While the examples above assume a long position (buy then sell), stop-loss orders are also used for short positions (sell then buy). If you sell shares expecting a drop, you can place a stop-loss buy order to protect against price increases.

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Short-Selling}

\subsection{Introduction}
In this section, we discuss what short selling is and how to use a stop-loss order to restrict losses after short selling shares. Previously, we assumed buying shares and restricting losses with a stop-loss sell order. The opposite is also possible: selling on the information that the stock price is going to drop.

\subsection{The Mechanics of Short Selling}
Short selling essentially means selling something that you do not own.
\begin{itemize}
    \item \textbf{Process:} You borrow shares from someone and sell them with a promise to return the borrowed shares at a future date.
    \item \textbf{Analogy:} This is similar to taking a loan. In a loan, you borrow cash and promise to pay it back. In short selling, the loan is for shares, not cash.
\end{itemize}

\subsection{Regulations and Risks}
\begin{itemize}
    \item \textbf{Regulations:} Various countries have regulations on how borrowing shares may be done. Some countries may ban it completely, while others may ban it temporarily for various reasons. Traders must check local exchange rules.
    \item \textbf{Risk Warning:} Short selling is extremely risky because stock prices generally increase over longer horizons. It is not advisable to hold such positions over long periods.
\end{itemize}

\subsection{Example: Shorting XYZ}
Suppose you expect the share price of XYZ to decrease.
\begin{itemize}
    \item \textbf{Action:} You short sell 100 shares at \$40 per share.
    \item \textbf{Scenario 1 (Price Drops):} If your information is right, prices decrease. You buy the 100 shares back at a lower price and return the borrowed shares.
    \item \textbf{Scenario 2 (Price Increases):} If you are wrong, prices increase. You still have an obligation to return the borrowed shares, so you must buy them back at higher prices, resulting in losses.
\end{itemize}

\subsection{Using Stop-Loss Orders}
To prevent large losses on account of price increases, you can enter a stop-loss order.
\begin{itemize}
    \item \textbf{Setup:} You enter a stop-loss order to buy 100 shares at \$44 (willing to lose around 10\%).
    \item \textbf{Trigger:} As long as the stock trades below \$44, the order is dormant. The moment the stock trades at \$44 or higher, the stop-loss order is triggered.
    \item \textbf{Execution:} Upon triggering, it converts to a \textbf{market order} and tries to execute against limit orders in the order book.
\end{itemize}

\subsection{Price Uncertainty and Stop-Limit Orders}
A stop-loss order at \$44 does not guarantee purchases at \$44 alone. The actual price may be greater than or less than \$44, especially when prices are changing rapidly.
\begin{itemize}
    \item \textbf{Stop-Limit Option:} To reduce price uncertainty, you could place a stop-loss order with a limit price. When triggered, this sends a limit order to the market.
    \item \textbf{Common Practice:} It is common to place stop-loss market orders rather than stop-loss limit orders because there is urgency in getting the order executed.
\end{itemize}

\subsection{Conclusion}
We will continue talking about different types of orders and additional instructions traders may attach to an order in the next section.

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Other Order Instructions}

\subsection{Introduction}
Over the last few sections, we covered common order types like market, limit, and stop-loss orders. In this section, we cover additional instructions a trader may add to market and limit orders. These instructions are broadly classified into validity, quantity, and display instructions. While not as common as standard orders, they serve specific purposes.

\subsection{Validity Instructions}
Validity instructions define the time horizon for which an order remains active.

\subsubsection{Day Orders}
\begin{itemize}
    \item Valid only for the day on which they are placed.
    \item If unexecuted by the end of the day, they are automatically cancelled.
    \item Typically applies to limit orders (market orders usually execute immediately).
\end{itemize}

\subsubsection{Good 'Til Orders}
Orders valid until a specific future event or date.
\begin{itemize}
    \item \textbf{Good 'Til Cancel (GTC):} Valid until executed or manually cancelled by the trader. Can be valid for less than or longer than a day.
    \item \textbf{Good 'Til Week (GTW):} Valid for the week submitted; cancelled if unexecuted by the end of the week.
    \item \textbf{Good 'Til Month (GTM):} Valid for the month submitted; cancelled if unexecuted by the end of the month.
    \item \textbf{Good 'Til Day (GTD):} Valid until a specified calendar date.
    \item \textbf{Good 'Til Expiration (GTE):} Used in derivative markets. Valid until the derivative contract expires.
\end{itemize}

\subsubsection{Time-Specific Validity}
\begin{itemize}
    \item \textbf{Good After Time/Date (GAT):} Orders that become active only after a specified time or date.
    \item \textbf{Market-on-Open:} Market orders executed specifically when the market opens (often used in opening call auctions).
    \item \textbf{Market-on-Close:} Market orders executed specifically at the closing price of the day.
\end{itemize}

\subsection{Quantity Instructions}
These instructions impose conditions on the quantity to be executed.

\subsubsection{Immediate-or-Cancel (IOC)}
Also known as "Good-on-Sight" orders.
\begin{itemize}
    \item Must execute immediately at the limit price or better.
    \item Any unexecuted portion is cancelled immediately.
    \item Partial executions are allowed.
\end{itemize}

\subsubsection{Fill-or-Kill (FOK)}
\begin{itemize}
    \item The entire order must be executed immediately or cancelled in its entirety.
    \item \textbf{Partial executions are NOT allowed.}
\end{itemize}

\subsubsection{All-or-None (AON)}
\begin{itemize}
    \item Requires full execution but does \textbf{not} demand immediacy.
    \item The order sits in the order book until it can be executed completely in a single shot.
\end{itemize}

\subsubsection{Minimum Volume Orders}
\begin{itemize}
    \item Requires a minimum quantity to be executed; otherwise, the order will not execute.
\end{itemize}

\subsection{Display Instructions}
Display instructions control the visibility of limit orders in the order book to prevent information leakage and adverse price movements.

\subsubsection{Hidden Orders}
\begin{itemize}
    \item Completely invisible in the order book.
    \item Existence is only known when a trade occurs against them (e.g., executing at a price better than the displayed best quote).
    \item \textbf{Example:} Suppose the displayed best bid and offer prices are \$40.00 and \$40.05 respectively. You submit a market order to buy shares, expecting to pay \$40.05 (the best ask). However, the order executes at \$40.03. This suggests there was a hidden sell order at \$40.03.
\end{itemize}

\subsubsection{Iceberg Orders}
\begin{itemize}
    \item Large orders that display only a small portion of their total size at a time.
    \item Example: Selling 1,000 shares but revealing only 100 at a time. Once the first 100 execute, the next 100 are revealed.
\end{itemize}

\subsection{Spread Orders}
Usually found in derivative markets. With spread orders, you try to buy a security with one expiration date and sell a related security with a different expiration date.

\subsection{Execution Priority and Trade-offs}
\begin{itemize}
    \item \textbf{Priority:} Exchanges typically give priority to orders with no conditions. Regular market and limit orders usually execute before conditional orders (except for IOC/FOK which demand immediacy).
    \item \textbf{Trade-off:} Adding instructions allows for specific execution strategies but may delay execution. Traders must decide if the condition is more critical than speed.
    \item \textbf{Exchange Rules:} Not all instructions are permitted on every exchange. Traders must verify local rules.
\end{itemize}

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Liquidity}

\subsection{Definition}
Liquidity is defined as the ability to trade quickly, in the quantity you desire, and at a low cost. It is one of the most important characteristics of an exchange.
\begin{itemize}
    \item \textbf{Virtuous Cycle:} There is a common saying that "liquidity begets liquidity." Highly liquid marketplaces attract more traders, which in turn increases liquidity further.
\end{itemize}

\subsection{Dimensions of Liquidity}
There are four main dimensions used to assess liquidity:

\subsubsection{1. Immediacy}
Immediacy measures how quickly trades of a given size can be executed at a given cost.
\begin{itemize}
    \item \textbf{Example:} If you want to buy 100 shares at a transaction cost of \$0.05 and can do so almost immediately, the market provides a high level of immediacy.
\end{itemize}

\subsubsection{2. Width}
Width measures the cost of trading a given size. It is usually measured by the \textbf{Bid-Ask Spread}.
\begin{itemize}
    \item \textbf{Narrow Spread:} Indicates low transaction costs and a liquid market.
    \item \textbf{Wide Spread:} Indicates an illiquid market.
\end{itemize}

\subsubsection{3. Depth}
Depth measures the trade size that can be executed at a given cost.
\begin{itemize}
    \item \textbf{Concept:} If the bid-ask spread is \$0.05, how many shares can be traded without changing the spread?
    \item \textbf{High Depth:} A large number of shares available at the best bid and ask prices allows for large orders without moving prices much.
\end{itemize}

\subsubsection{4. Resiliency}
Resiliency measures how quickly prices revert to previous levels after a large trade is executed.
\begin{itemize}
    \item \textbf{Example:} Suppose a 10,000-share order moves prices by \$0.50 and widens the spread from \$0.05 to \$0.55. If traders refill the order book quickly, bringing prices and the spread back to original levels, the market is resilient.
\end{itemize}

\subsection{Conclusion}
A liquid market allows traders to execute large orders with minimal price impact almost instantaneously. Even when prices move due to large orders, a liquid market is characterized by quick price reversion. Next, we will discuss how to measure transaction costs and the various benchmarks used.

\noindent\rule{\linewidth}{1pt}
%-----------------------------------------------------------------
\section{Transaction Costs}

\subsection{Introduction}
Last time we discussed the idea of liquidity and its various dimensions. Even in the most liquid of markets, investors still have to bear transaction costs. This can't be avoided. These costs reduce the returns a person earns from their investments. To increase returns net of transaction costs, it is critical to understand what the transaction costs are, how to measure them, and then attempt to trade in a manner that reduces these costs. In this section, we will focus on discussing what the transaction costs are and how to measure them.

Transaction costs help investors evaluate how well they and their brokers have executed their trading strategies. They are also used by exchanges, brokers, and regulators. Exchanges are interested in calculating transaction costs to determine how liquid their market is and use this as part of their marketing strategies. They also help brokers evaluate their execution performance, identify better execution strategies, and minimize transaction costs. Regulators are interested in calculating transaction costs as they help to monitor the performance of exchanges and change policies accordingly to further reduce transaction costs on exchanges.

\subsection{Measuring Transaction Costs}
How do we measure transaction costs? It is the difference between the value of a paper portfolio and the value of a real portfolio. Say that you decide to put together a portfolio of stocks worth \$100,000. The paper portfolio will assume that you paid the decision-time midpoint of the best bid and ask prices. However, in reality, you have to pay the bid-ask spread, brokerage commissions, price impact, fees, taxes, etc. All of these will affect the actual return you realize from your investment portfolio.

\subsection{Components of Transaction Costs}
There are two components to transaction costs: explicit costs and implicit costs.

\subsubsection{Explicit Costs}
Explicit costs are actual out-of-pocket expenses incurred. They include brokerage commissions and any taxes and fees paid for every transaction. These are easy to identify and measure and need to be simply added up.

\subsubsection{Implicit Costs}
Implicit costs are those that are not obvious but still imposed on traders. These include spreads, market impact cost, opportunity cost, delay cost, etc. Implicit costs are more difficult to identify and quantify. For example, if you want to measure the price impact of a trade, we must have some estimate of what the price would have been had the trade not taken place. Unfortunately, we can't observe that.

\subsection{Calculating Implicit Costs}
There are a number of ways to measure these implicit costs. The only difference among these different ways is the benchmark used. One-way implicit transaction costs have the following general form:

\[
    \text{Implicit Cost} = \sum_{j} x_j d_j (p_j - b_j)
\]

Where:
\begin{itemize}
    \item $x_j$: Size of trade $j$.
    \item $d_j$: Direction of trade ($+1$ for buy, $-1$ for sell).
    \item $p_j$: Trade price.
    \item $b_j$: Benchmark price at the time of trade.
\end{itemize}

Essentially, these implicit costs measure how large a premium over the benchmark a trader is willing to pay while buying and how large a discount relative to the benchmark a trader is willing to accept while selling. The benchmark is assumed to represent the true value of the stock. A round-trip implicit transaction cost is two times the one-way implicit transaction cost.

\subsection{Benchmarks}
There are five common benchmarks used to compute implicit transaction costs.

\subsubsection{Time-Weighted Average Price (TWAP)}
For a stock with $N$ trades in a given day, TWAP is the average transaction price across the $N$ trades.

\subsubsection{Volume-Weighted Average Price (VWAP)}
VWAP is the trade-size weighted average transaction price. The price of each transaction is multiplied by its size and then divided by the total volume traded for the day. This is summed up across all trades of the day.

\subsubsection{Implementation Shortfall (Decision-Time Midpoint)}
The third benchmark is the midpoint of the bid and ask prices at the time the investor decides to trade (decision time). In this case, in addition to the difference between the trade price and the benchmark, the transaction cost also captures an opportunity cost for the part of the order that is not executed. This method is called the \textbf{Implementation Shortfall} method.

For the executed portion:
\[
    \text{Execution Cost} = \sum x_j d_j (p_j - m_d)
\]
Where $m_d$ is the decision-time bid-ask midpoint.

The opportunity cost is computed as:
\[
    \text{Opportunity Cost} = (X - \sum x_j) d (p_N - m_d)
\]
Where:
\begin{itemize}
    \item $X$: Total order size.
    \item $\sum x_j$: Total number of shares bought or sold.
    \item $d$: Order direction.
    \item $p_N$: Last price of the day.
\end{itemize}

The difference between $X$ and $\sum x_j$ represents the part of the order that isn't executed by the end of the day. This non-execution results in an opportunity cost due to potentially lost profits. For a buy order, it assumes that you could have bought the shares at $m_d$ and sold them at $p_N$ at the end of the day. As prices increase during the day, this is lost profit; on the other hand, if prices decrease during the day, this difference is losses avoided. The implementation shortfall method adds this opportunity cost to the implicit transaction cost calculated using the decision-time bid-ask price midpoint as the benchmark.

\subsubsection{Other Benchmarks}
\begin{itemize}
    \item \textbf{Closing Price:} Typically the price of the last transaction of the day.
    \item \textbf{Midpoint at Time of Trade:} The midpoint of the bid and ask prices at the time of the trade.
\end{itemize}

There are a few other benchmarks that traders use which we won't focus on:
\begin{itemize}
    \item Previous day's closing price.
    \item Current day's opening price.
    \item Next day's closing price.
    \item Bid-ask price midpoint at the time the order arrives in the market.
    \item Average of the day's open, high, low, and closing prices.
\end{itemize}

Next time we will look at a detailed example that will illustrate how to compute these benchmarks and then calculate implicit transaction costs.


\noindent\rule{\linewidth}{1pt}

\end{document}